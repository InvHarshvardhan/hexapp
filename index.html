<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HexApp</title>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { display: flex; height: 100vh; background: #f0f2f5; }
    .sidebar { width: 300px; background: #128C7E; color: white; padding: 15px; display: flex; flex-direction: column; }
    .sidebar-header { display: flex; align-items: center; margin-bottom: 20px; }
    .sidebar-header h2 { margin-left: 10px; font-weight: 600; }
    .search-box { background: rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 12px; display: flex; align-items: center; margin-bottom: 20px; }
    .search-box input { background: transparent; border: none; outline: none; color: white; width: 100%; margin-left: 8px; }
    .chat-list { flex: 1; overflow-y: auto; }
    .chat-item { display: flex; align-items: center; padding: 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
    .chat-item:hover { background: rgba(255,255,255,0.1); }
    .avatar { width: 45px; height: 45px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #555; margin-right: 12px; }
    .chat-info { flex: 1; }
    .chat-name { font-weight: 600; }
    .last-msg { font-size: 0.85em; color: rgba(255,255,255,0.8); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .main-chat { flex: 1; display: flex; flex-direction: column; background: url('https://i.imgur.com/jtQvFbY.jpg') center/cover; }
    .chat-header { background: #128C7E; color: white; padding: 12px 16px; display: flex; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .chat-header .avatar { margin-right: 12px; }
    .header-title { flex: 1; }
    .header-icons i { margin-left: 16px; font-size: 1.3em; cursor: pointer; transition: all 0.2s; }
    .header-icons i:hover { transform: scale(1.1); }
    .notification-btn { position: relative; background: none; border: none; color: white; cursor: pointer; font-size: 1.3em; margin-left: 16px; }
    .notification-btn.muted { opacity: 0.5; }
    .notification-btn.muted::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(45deg); width: 2px; height: 20px; background: red; }
    .messages-container { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
    .message { max-width: 70%; padding: 10px 14px; border-radius: 10px; margin-bottom: 10px; position: relative; word-wrap: break-word; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
    .self { background: #005C4B; color: white; align-self: flex-end; border-bottom-right-radius: 0; }
    .other { background: white; color: #333; align-self: flex-start; border-bottom-left-radius: 0; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .system { background: #e9ecef!important; color: #6c757d!important; align-self:center!important; text-align:center!important; font-style: italic; max-width:90%!important; border-radius:20px!important; box-shadow:none!important; }
    .message.alert { background: linear-gradient(135deg, #ff6b6b, #ff4444); color: white; font-weight: bold; box-shadow: 0 4px 15px rgba(255,68,68,.3); animation: pulseAlert 2s infinite; }
    @keyframes pulseAlert { 0%,100% { transform:scale(1);} 50%{ transform:scale(1.02);} }
    .alert-badge { display:inline-block; background:rgba(255,255,255,0.3); padding:2px 8px; border-radius:12px; font-size:0.75em; margin-right:8px; }
    .message-time { font-size:0.7em; opacity:0.7; margin-top:4px; text-align: right;}
    .input-area { background:white; padding:12px 16px; display:flex; align-items:center; box-shadow:0 -1px 5px rgba(0,0,0,0.1);}
    .input-area input { flex:1; border:none; outline:none; font-size:1rem; padding:8px 0;}
    .input-buttons { display:flex; align-items:center; gap:8px; margin-left:10px;}
    .input-area button { background:#128C7E; color:white; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2em; transition: all .2s;}
    .input-area button:hover { background:#075e54; transform:scale(1.05);}
    .alert-btn { background:#ff4444!important; animation: glow 2s ease-in-out infinite;}
    @keyframes glow {0%,100%{box-shadow:0 0 5px rgba(255,68,68,.5);}50%{box-shadow:0 0 20px rgba(255,68,68,.8);}}
    .alert-modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:2000;}
    .alert-modal-content { background:white; padding:30px; border-radius:15px; text-align:center; max-width:400px;}
    .alert-icon { font-size:60px; color:#ff4444; margin-bottom:20px;}
    .online { position:absolute; bottom:0; right:0; width:12px; height:12px; background:#34c759; border:2px solid white; border-radius:50%;}
    .notification-popup { position:fixed; top:20px; left:50%; transform:translateX(-50%); background:white; padding:16px 24px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,.2); z-index:1000; display:none;}
    .toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#333; color:white; padding:12px 20px; border-radius:8px; display:none;}
    .tooltip { position:relative; }
    .tooltip::before { content: attr(data-tooltip); position:absolute; bottom:120%; left:50%; transform:translateX(-50%); background:#333; color:white; padding:5px 10px; border-radius:5px; font-size:0.8em; white-space:nowrap; opacity:0; transition: opacity .3s;}
    .tooltip:hover::before { opacity:1; }
  </style>
</head>
<body>

  <!-- Alert Modal -->
  <div id="alertModal" class="alert-modal">
    <div class="alert-modal-content">
      <div class="alert-icon">🚨</div>
      <h2>URGENT ALERT!</h2>
      <p id="alertMessage">You received an urgent notification!</p>
      <button onclick="closeAlertModal()">OK, Got it!</button>
    </div>
  </div>

  <!-- Notification Popup -->
  <div id="notificationPopup" class="notification-popup">
    <h3>🔔 Enable Notifications?</h3>
    <p>Get notified when you receive new messages</p>
    <button onclick="enableNotifications()">Allow</button>
    <button class="secondary" onclick="closeNotificationPopup()">Not Now</button>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="avatar">H</div><h2>HexApp</h2>
    </div>
    <div class="search-box"><i class="fas fa-search"></i><input placeholder="Search or start new chat" disabled></div>
    <div class="chat-list"><div class="chat-item"><div class="avatar">T</div><div class="chat-info"><div class="chat-name">Test User</div><div class="last-msg">Online now</div></div><span class="online"></span></div></div>
  </div>

  <!-- Main Chat -->
  <div class="main-chat">
    <div class="chat-header">
      <div class="avatar">T</div>
      <div class="header-title"><h3>Test User</h3><p style="font-size:0.85em;opacity:.8;">online</p></div>
      <div class="header-icons">
        <i class="fas fa-video"></i><i class="fas fa-phone"></i>
        <button id="notificationBtn" class="notification-btn" onclick="toggleNotifications()" title="Toggle notifications"><i class="fas fa-bell"></i></button>
        <i class="fas fa-ellipsis-v"></i>
      </div>
    </div>
    <div class="messages-container" id="messages"></div>
    <div class="input-area">
      <input id="msg" type="text" placeholder="Type a message" onkeypress="handleKeypress(event)">
      <div class="input-buttons">
        <button class="alert-btn tooltip" data-tooltip="Send Alert!" onclick="sendAlert()"><i class="fas fa-exclamation-triangle"></i></button>
        <button class="tooltip" data-tooltip="Send Message" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <!-- Correct Socket.IO client -->
  <script src="https://hexapp-backend-production.up.railway.app/socket.io/socket.io.js"></script>
  <script>
    const socket = io("https://hexapp-backend-production.up.railway.app/");
    const messagesList = document.getElementById("messages");
    const notificationBtn = document.getElementById("notificationBtn");
    const toast = document.getElementById("toast");
    const alertModal = document.getElementById("alertModal");

    let notificationsEnabled=true, unreadCount=0, isPageVisible=true;
    document.addEventListener("visibilitychange",()=>{isPageVisible=!document.hidden;if(isPageVisible){unreadCount=0;updateTitle();}});
    window.onload=()=>{addIPMessage(); if("Notification" in window && Notification.permission==="default"){document.getElementById("notificationPopup").style.display="block";}
      setTimeout(()=>{addMessage("Hello! Welcome to HexApp 🚀 Your notifications are "+(notificationsEnabled?"enabled 🔔":"muted 🔕"),"other",false);},1000);};
    async function addIPMessage(){try{const res=await fetch("https://api.ipify.org?format=json");const d=await res.json();const ip=d.ip;const msg=`System: Your public IP address is <a href="http://${ip}" target="_blank" style="color:#128C7E;text-decoration:underline;">http://${ip}</a> (Click to open)`;addMessage(msg,"system",false);}catch{addMessage("System: Could not fetch IP. Try ◇ curl ifconfig.me","system",false);}}
    function enableNotifications(){if("Notification" in window){Notification.requestPermission().then(p=>{if(p==="granted"){showToast("✅ Notifications enabled!");notificationsEnabled=true;new Notification("HexApp",{body:"Notifications are now enabled!",icon:"https://cdn-icons-png.flaticon.com/512/733/733585.png"});}else{showToast("❌ Notifications blocked.");}});}closeNotificationPopup();}
    function closeNotificationPopup(){document.getElementById("notificationPopup").style.display="none";}
    function toggleNotifications(){notificationsEnabled=!notificationsEnabled;notificationBtn.classList.toggle("muted",!notificationsEnabled);showToast(notificationsEnabled?"🔔 Notifications ON":"🔕 Notifications OFF");}
    function showToast(m){toast.textContent=m;toast.style.display="block";setTimeout(()=>toast.style.display="none",3000);}
    function playNotificationSound(isA=false){if(!notificationsEnabled&&!isA)return;const ctx=new(window.AudioContext||window.webkitAudioContext)();if(isA){for(let i=0;i<3;i++){setTimeout(()=>{const o=ctx.createOscillator();const g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.frequency.value=1000;o.type="square";g.gain.setValueAtTime(0.5,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.3);o.start(ctx.currentTime);o.stop(ctx.currentTime+0.3);},i*400);}}else{const o=ctx.createOscillator();const g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.frequency.value=800;o.type="sine";g.gain.setValueAtTime(0.3,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.5);o.start(ctx.currentTime);o.stop(ctx.currentTime+0.5);}}
    function showDesktopNotification(t,isA=false){if(!notificationsEnabled&&!isA)return;if("Notification" in window&&Notification.permission==="granted"){const n=new Notification(isA?"🚨 URGENT ALERT - HexApp":"HexApp - New Message",{body:t,icon:isA?"https://cdn-icons-png.flaticon.com/512/3521/3521964.png":"https://cdn-icons-png.flaticon.com/512/733/733585.png",badge:"https://cdn-icons-png.flaticon.com/512/733/733585.png",vibrate:isA?[200,100,200,100,200]:[200,100,200],tag:isA?"hexapp-alert":"hexapp-message",requireInteraction:isA,renotify:isA});n.onclick=()=>{window.focus();n.close();};if(!isA){setTimeout(()=>n.close(),5000);}}}
    function showAlertModal(m){document.getElementById("alertMessage").textContent=m;alertModal.style.display="flex";document.body.style.animation="flash .5s ease 3";setTimeout(()=>document.body.style.animation="",1500);}
    function closeAlertModal(){alertModal.style.display="none";}
    function updateTitle(){document.title=unreadCount>0?`(${unreadCount}) HexApp`:"HexApp";}
    function getCurrentTime(){const n=new Date();return n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0");}
    function addMessage(t,type,isA=false){const d=document.createElement("div");d.classList.add("message",type);if(isA)d.classList.add("alert");const ts=document.createElement("div");if(isA)ts.innerHTML='<span class="alert-badge">🚨 ALERT</span>'+t;else if(type==="system")ts.innerHTML=t;else ts.textContent=t;const tm=document.createElement("div");tm.classList.add("message-time");tm.textContent=getCurrentTime();d.appendChild(ts);d.appendChild(tm);messagesList.appendChild(d);messagesList.scrollTop=messagesList.scrollHeight;if(type==="other"){if(isA){playNotificationSound(true);showDesktopNotification(t,true);showAlertModal(t);if("vibrate" in navigator)navigator.vibrate([200,100,200,100,200]);}else{playNotificationSound(false);if(!isPageVisible){showDesktopNotification(t,false);unreadCount++;updateTitle();}}}}
    function handleKeypress(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendMessage();}}
    function sendMessage(){const input=document.getElementById("msg");const t=input.value.trim();if(!t)return;addMessage(t,"self",false);socket.emit("sendNotification",{text:t,isAlert:false});input.value="";}
    function sendAlert(){const input=document.getElementById("msg");let t=input.value.trim();if(!t)t="⚠️ This is an urgent alert! Please check immediately!";addMessage(t,"self",true);socket.emit("sendNotification",{text:t,isAlert:true});input.value="";showToast("🚨 Alert sent!");}
    socket.on("receiveNotification",d=>{addMessage(d.text,"other",d.isAlert||false);});
    const s=document.createElement("style");s.textContent=`@keyframes flash{0%,100%{filter:brightness(1);}50%{filter:brightness(1.3);}}`;document.head.appendChild(s);
  </script>
</body>
</html>